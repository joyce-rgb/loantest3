<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼æ¥­èè³‡è¨ºæ–·ç³»çµ±</title>
    <style>
        :root { --primary: #007bff; --line: #06C755; --credit: #2c3e50; --tax: #f39c12; --bg: #f8f9fa; }
        body { font-family: -apple-system, "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .card { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 500px; box-sizing: border-box; }
        .status-DANGER { border-top: 10px solid #dc3545; }
        .status-WARNING { border-top: 10px solid #ffc107; }
        .status-SUCCESS { border-top: 10px solid #28a745; }
        h2 { margin-top: 0; color: #333; text-align: center; }
        p { line-height: 1.6; color: #444; text-align: center; font-size: 1.1rem; }
        .tips-box { font-size: 0.95rem; color: #555; margin: 20px 0; padding: 15px; background: #fff9e6; border-radius: 12px; border-left: 5px solid #ffc107; }
        .option-btn { display: block; width: 100%; padding: 16px; margin: 12px 0; border: 1px solid #ddd; background: white; border-radius: 12px; font-size: 1.05rem; cursor: pointer; transition: 0.2s; }
        .option-btn:hover { background: #f0f7ff; border-color: var(--primary); color: var(--primary); }
        .external-btn { display: block; width: 100%; padding: 16px; margin-top: 12px; color: white; text-decoration: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; text-align: center; box-sizing: border-box; }
        .btn-line { background-color: var(--line); }
        .btn-blue { background-color: var(--primary); }
        .btn-dark { background-color: var(--credit); }
        .btn-orange { background-color: var(--tax); }
        .external-btn:hover { opacity: 0.9; transform: translateY(-2px); transition: 0.2s; }
    </style>
</head>
<body>
<div id="app" class="card">
    <div id="content-body">
        <h2 style="text-align: center;">è¼‰å…¥ä¸­...</h2>
    </div>
    <div id="options-list"></div>
    <div id="links-list" style="margin-top: 20px;"></div>
</div>

<script>
    const contentBody = document.getElementById('content-body');
    const optionsList = document.getElementById('options-list');
    const linksList = document.getElementById('links-list');
    const appCard = document.getElementById('app');

    async function loadNode(id = 'START', index = null) {
        // ä½¿ç”¨ç›¸å°è·¯å¾‘ï¼Œç¢ºä¿ Vercel èƒ½æ­£ç¢ºå°å‘
        let apiUrl = `/api/quiz?currentId=${id}`;
        if (index !== null) apiUrl += `&optionIndex=${index}`;
        
        try {
            const res = await fetch(apiUrl);
            if (!res.ok) throw new Error('ç¶²è·¯å›æ‡‰ä¸æ­£ç¢º');
            const data = await res.json();
            
            // æ›´æ–°æ¨£å¼èˆ‡å…§å®¹
            appCard.className = `card status-${data.status || 'DEFAULT'}`;
            contentBody.innerHTML = `
                <h2>${data.title}</h2>
                <p>${data.question || data.content}</p>
                ${data.tips ? `<div class="tips-box">ğŸ’¡ å»ºè­°ï¼š${data.tips}</div>` : ''}
            `;
            
            // é¸é …æŒ‰éˆ•
            optionsList.innerHTML = '';
            data.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.label;
                btn.onclick = () => loadNode(data.id, i);
                optionsList.appendChild(btn);
            });

            // è·³è½‰æŒ‰éˆ•
            linksList.innerHTML = '';
            if (data.externalLinks && data.externalLinks.length > 0) {
                data.externalLinks.forEach(link => {
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.target = '_blank';
                    a.innerText = link.label;
                    if (link.url.includes('lin.ee')) a.className = 'external-btn btn-line';
                    else if (link.url.includes('etax.nat.gov.tw')) a.className = 'external-btn btn-orange';
                    else if (link.url.includes('flybooking')) a.className = 'external-btn btn-dark';
                    else a.className = 'external-btn btn-blue';
                    linksList.appendChild(a);
                });
            }

            // é‡æ¸¬æŒ‰éˆ•
            if (data.type === 'RESULT') {
                const re = document.createElement('button');
                re.className = 'option-btn';
                re.style.marginTop = '30px';
                re.style.color = '#888';
                re.innerText = 'ğŸ”„ é‡æ–°æª¢æ¸¬';
                re.onclick = () => loadNode('START');
                optionsList.appendChild(re);
            }
        } catch (err) {
            contentBody.innerHTML = `<h2>é€£ç·šç•°å¸¸</h2><p>ç„¡æ³•å–å¾—è¨ºæ–·è³‡æ–™ï¼Œè«‹æª¢æŸ¥ API éƒ¨ç½²è·¯å¾‘ã€‚</p>`;
            console.error(err);
        }
    }

    // åˆå§‹åŒ–å•Ÿå‹•
    loadNode();
</script>
</body>
</html>
